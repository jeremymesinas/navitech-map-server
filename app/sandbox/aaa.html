<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draggable Segmented SVG</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f4f4f4;
    }
    svg {
      border: 2px solid #444;
      background: white;
      max-width: 90vw;
      max-height: 90vh;
    }
    path {
      cursor: grab;
    }
  </style>
</head>
<body>
<svg id="floorplan" xmlns="http://www.w3.org/2000/svg" width="5364" height="3226" viewBox="0 0 5364 3226"><path d="M 434 258 L 434 265 L 439 265 L 440 266 L 442 266 L 443 265 L 450 265 L 452 263 L 453 263 L 453 261 L 446 261 L 445 260 L 444 260 L 443 259 L 442 259 L 441 258 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 434 34 L 434 227 L 463 229 L 465 271 L 558 272 L 564 228 L 628 225 L 626 34 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 14 34 L 14 273 L 129 273 L 129 228 L 221 227 L 221 34 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 10 278 L 10 388 L 133 387 L 133 278 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 462 381 L 461 380 L 460 383 L 457 385 L 450 385 L 449 384 L 435 384 L 434 385 L 429 385 L 428 386 L 425 386 L 425 389 L 462 389 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 430 238 L 428 241 L 428 265 L 429 266 L 454 266 L 454 253 L 453 252 L 453 248 L 454 247 L 454 241 L 453 239 L 449 237 L 447 237 L 446 238 L 439 238 L 438 237 L 437 238 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 464 195 L 460 198 L 460 202 L 455 206 L 454 210 L 455 217 L 461 222 L 461 225 L 466 228 L 465 233 L 465 256 L 466 257 L 465 267 L 466 270 L 469 270 L 469 195 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 442 93 L 440 97 L 440 102 L 439 103 L 441 120 L 442 121 L 451 120 L 453 123 L 458 124 L 466 129 L 469 129 L 469 92 L 466 92 L 465 93 L 448 93 L 447 92 L 444 92 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 442 42 L 443 42 L 445 44 L 445 49 L 446 50 L 450 50 L 454 53 L 458 53 L 462 58 L 464 58 L 465 59 L 469 59 L 469 34 L 457 34 L 457 37 L 455 39 L 451 41 L 443 41 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 228 34 L 227 290 L 206 276 L 194 243 L 138 241 L 138 389 L 215 389 L 220 368 L 314 371 L 320 389 L 403 389 L 404 330 L 463 324 L 462 278 L 419 272 L 428 136 L 422 125 L 417 134 L 393 125 L 388 69 L 404 73 L 406 46 L 393 34 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 410 334 L 410 389 L 463 389 L 464 334 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 138 238 L 138 388 L 221 388 L 221 238 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /><path d="M 426 238 L 426 268 L 433 268 L 434 267 L 447 267 L 448 268 L 453 268 L 456 266 L 456 238 Z" fill="#f9dfb9" stroke="#dfb77e" stroke-width="2" /></svg>

<script>
const svg = document.getElementById("floorplan");
let selected = null, start = {x:0, y:0}, transform = {x:0, y:0};
let deletedStack = [];

// --- Drag logic ---
function getSVGCoords(evt) {
  const pt = svg.createSVGPoint();
  pt.x = evt.clientX;
  pt.y = evt.clientY;
  return pt.matrixTransform(svg.getScreenCTM().inverse());
}

svg.addEventListener("mousedown", e => {
  if (e.target.tagName === "path") {
    // Highlight logic
    if (selected && selected !== e.target) {
      selected.removeAttribute("data-selected");
    }
    selected = e.target;
    selected.setAttribute("data-selected", "true");

    // Drag logic
    const coords = getSVGCoords(e);
    start.x = coords.x;
    start.y = coords.y;
    const match = /translate\(([-\d.]+),\s*([-\d.]+)\)/.exec(selected.getAttribute("transform"));
    transform.x = match ? parseFloat(match[1]) : 0;
    transform.y = match ? parseFloat(match[2]) : 0;
  } else {
    // Clicked outside any path
    if (selected) selected.removeAttribute("data-selected");
    selected = null;
  }
});

svg.addEventListener("mousemove", e => {
  if (selected && selected.hasAttribute("data-selected")) {
    const coords = getSVGCoords(e);
    const dx = coords.x - start.x;
    const dy = coords.y - start.y;
    selected.setAttribute("transform", `translate(${transform.x + dx}, ${transform.y + dy})`);
  }
});

svg.addEventListener("mouseup", () => {});
svg.addEventListener("mouseleave", () => {});

// --- Delete and Undo ---
document.addEventListener("keydown", e => {
  if (e.key === "Delete" && selected && selected.hasAttribute("data-selected")) {
    // Remove selected path and push to stack
    deletedStack.push({
      element: selected,
      parent: selected.parentNode,
      nextSibling: selected.nextSibling
    });
    selected.parentNode.removeChild(selected);
    selected = null;
  }
  // Undo with Ctrl+Z
  if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "z" && deletedStack.length > 0) {
    const last = deletedStack.pop();
    last.parent.insertBefore(last.element, last.nextSibling);
  }
});

svg.addEventListener("dblclick", e => {
  if (e.target.tagName === "path" && e.target.hasAttribute("data-selected")) {
    e.target.removeAttribute("data-selected");
    selected = null;
  }
});

// --- Style for highlight ---
const style = document.createElement("style");
style.textContent = `
  path[data-selected="true"] {
    stroke: #ff3333 !important;
    stroke-width: 4 !important;
    filter: drop-shadow(0 0 8px #ff3333);
    cursor: pointer;
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>
